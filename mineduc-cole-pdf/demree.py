# encoding: utf-8
import urllib
from lxml import html
import re
import unicodedata
from django.template.defaultfilters import slugify
#from regiones import REGIONES, COMUNAS

RBD=[16799,25960,11931,10542,26150,10615,20308,10611,10628,25503,25695,31392,10607,10606,16783,25698,31495,10600,25882,31379,25714,12111,25418,26362,10610,26454,26423,25347,10608,16886,25557,25954,10594,26017,10581,26367,26466,10588,10586,31278,12775,10635,10618,10592,10541,10584,10544,10545,24444,31293,10569,10551,10543,24686,25009,11843,25865,26383,25477,31042,24874,24976,10688,10686,16830,26269,24719,25278,26482,25241,31040,24836,25602,26117,20402,999999,31267,10638,10641,10645,10642,10658,25591,10663,31260,26006,26094,26012,10685,26507,25371,25711,10669,31264,10666,25725,10667,25339,10683,25454,10540,10526,24907,24783,24652,10520,10516,26333,25523,25736,25753,25171,25735,24878,25059,10460,25439,31388,25640,25999,31327,24988,24894,10482,25876,10484,10492,26054,10503,24713,24767,24814,10479,24491,25071,10512,24648,10457,24977,24438,25223,25540,25070,26381,25936,25389,25737,25166,25475,24978,25094,25558,25580,10513,25571,25050,25613,25781,25282,10500,10501,24935,25330,24892,10487,25676,25061,25615,31080,25450,24995,10493,12077,24410,10506,25556,31421,26115,25136,10449,10450,10515,10496,25257,25084,10507,25043,25218,31078,10456,10453,10470,24443,10489,31395,10505,10452,10455,10044,12241,26531,10069,25508,8629,25458,10059,10042,10023,9982,9985,11831,10073,9986,10030,8508,10254,11965,31494,8750,25138,8614,10313,8682,8650,24423,10255,10352,8553,10252,10320,8502,10397,8813,10248,8636,8510,10396,8632,8494,26046,31044,24790,31429,24969,25215,24843,12242,26365,24966,25895,25922,26260,10187,12778,11923,25496,10130,10120,24889,10077,25978,25487,26033,25969,25988,25929,25961,25829,25599,25349,25386,25387,10246,25853,26168,26083,24769,25542,26110,12117,31378,26272,25182,31299,25235,8645,31083,25028,9087,24700,9106,9105,24930,24873,25478,25717,25247,9221,26286,24971,9239,25589,9127,25489,26305,24789,25723,25804,9200,9158,25065,9182,25172,9213,26075,25611,26155,26019,9117,9140,9121,9244,25212,9088,9107,9164,25402,13210,25666,8992,31438,8998,8974,8950,26112,26030,8981,26426,13215,8761,24985,8956,8876,8954,8988,25541,8944,11871,8938,8966,8996,8959,24947,9003,9271,8984,9004,25652,8945,24896,24933,8930,8927,8926,8928,8925,8997,9194,12217,9082,9217,9135,9250,25054,25852,31281,12133,24801,9278,9230,25058,24842,24830,25716,9147,9184,9249,9246,9263,9151,9179,9259,9216,8969,25686,9276,9270,31258,9077,9146,9209,9159,9228,9058,9071,9073,9065,9177,9267,9063,9074,9078,11893,9061,9060,9100,9064,9747,26143,9845,9799,9506,9410,9505,26324,9694,9419,9695,9686,26219,12115,25303,25085,10232,20436,26061,25948,24812,24498,26084,24623,31153,10196,31037,24828,24482,10201,9411,11921,9500,11814,25783,9502,26032,9579,9486,9408,11811,10726,10734,10725,31253,31052,10727,31162,16857,31066,10744,24963,10735,25752,10710,10724,24725,25127,16807,25130,10713,25843,25795,10723,25442,25452,11867,24446,10721,25919,10694,10717,10715,10719,24440,31294,10711,10697,10696,25448,25524,31368,10772,26524,24496,26027,12258,11851,25434,25026,26416,10777,25984,25944,26378,31509,10751,10746,26404,25982,10757,25048,25238,26092,25352,25543,26254,10773,10749,25520,9051,12087,25101,9042,9035,24627,31146,31189,24671,24678,8949,9008,24944,31273,9039,9054,25373,9020,24690,11971,9033,9053,12090,9046,24902,9006,9007,9583,9665,25462,25365,26063,24664,12269,24946,24885,9634,25250,25779,25027,11805,25671,24714,24403,25082,24956,24689,25562,25114,24876,9656,25938,24445,25824,25220,9637,31161,24717,9684,24459,20404,9655,9585,26501,9587,9617,11994,9582,11977,9373,25322,9347,9312,16958,25366,13220,25221,25045,9330,26001,24766,25650,26328,24448,26053,9338,31387,12085,26087,25932,25842,26028,24800,31034,9385,25751,24599,9318,24756,26411,25704,25703,25712,25709,25577,25713,25644,25722,25724,9362,25153,9356,9331,9328,9377,25068,24405,25393,31252,25382,8724,24864,9534,9396,9340,24798,9332,25367,25950,11947,9292,11793,11952,9283,9285,9324,24426,9369,25342,9339,9317,31432,9294,9281,9298,9288,9293,26292,12234,26519,25196,25271,25183,24730,10076,25839,10128,10140,10106,10091,10162,9690,31332,9853,9828,31048,9796,9800,26372,9810,9697,9726,12225,8860,25224,25395,8917,25654,24718,8903,24979,25107,8880,8841,24486,8995,24624,11776,8869,31499,24751,26037,8839,9237,25630,31047,8861,24884,8979,25142,8911,8921,12266,8870,8883,8902,12086,24494,11968,8895,8878,8888,8978,24506,24795,8867,25055,8893,8868,8849,24721,8827,24826,8991,24908,11966,26134,8885,26080,8815,25767,8892,9038,25825,24409,8863,8900,12265,8873,8872,8914,24832,8854,24666,8818,8822,8819,8835,8828,24761,9867,26214,9909,25197,25633,9924,8681,24986,25817,25921,26201,26371,26085,9911,26137,25850,9950,9913,26405,9945,25481,26465,25885,24670,11936,25700,25739,25681,25749,25368,25270,25471,25785,25369,25775,9910,25790,25258,9907,9917,9955,26268,25501,31290,26368,24898,26209,9970,25175,25198,9973,9926,26436,26538,25160,24626,9959,25091,25550,25766,25300,26228,25025,9887,9877,9906,9967,25328,9896,31074,8511,9957,9981,9864,9937,25770,9897,9889,9905,9863,31065,26118,26225,9168,25693,25625,25525,9172,24762,9277,24427,9075,9208,9150,25514,9069,9185,9072,10833,31428,24715,31279,25038,24699,10834,24913,26213,25692,25012,10828,25095,10831,10830,10832,24675,24912,25447,10829,10783,10781,10792,10780,10873,31375,24897,24759,25526,10851,10845,20348,11883,10854,31192,31064,25926,26379,10419,25484,26135,26045,10422,25132,26035,25812,26157,10377,12766,31187,26503,10433,10432,25592,25348,31163,26077,26238,24945,26335,25669,20400,26311,25332,25855,25032,25180,24927,24733,25121,25310,25329,31068,25916,20441,31071,10408,10405,24900,10399,10398,26399,11855,10224,10350,8728,8644,10355,11885,8654,8616,10220,8769,8621,24763,8497,8589,10199,8514,8542,10223,9782,9757,25995,9781,9771,9797,25265,9827,25480,9829,9801,9855,9758,9766,26384,25029,9779,11918,9754,9860,9759,9767,25727,9693,9784,9701,9722,25396,10315,25951,20399,10344,10329,10385,10259,10269,10251,10253,10632,10573,26048,25504,9844,10626,25645,25249,25304,9834,25464,26025,25655,9780,10604,11818,9713,9824,10555,25256,9841,9852,9768,9687,9743,10572,9688,9861,25977,8631,8613,25001,9912,24685,10058,8657,8715,31287,9940,9930,9960,9942,9866,8587,8518,9862,8634,10250,25899,25202,26476,25502,31276,10337,25143,24407,31373,26023,8625,31167,8603,11962,8680,8598,25463,25057,31039,8763,25237,25099,11755,24840,20310,8756,8791,8658,8754,25213,8748,11766,26499,11767,8649,8740,25359,8611,25269,8697,25818,25509,25185,8646,8755,8652,8609,8620,8759,8604,8762,8666,8627,8675,24473,8601,25959,8615,8571,8676,8671,8503,8643,8506,8618,8499,31376,31295,8489,8507,8495,8498,8541,24911,8491,8814,8812,8500,8485,8488,8487,8768,8592,8492,24638,8554,8490,12260,8617,8501,8496,8505,8811,8535,8504,8639,9947,9903,9919,9979,26164,9972,9923,9865,9900,24754,24926,26303,10193,10164,10126,10158,31288,10052,10075,25014,9608,9601,9646,9659,9631,9660,9643,9584,9599,9586,9647,16820,26062,25874,9553,25894,9564,25675,25718,25832,25798,24625,9484,9519,9509,11812,9461,9407,9487,9504,31030,9460,9474,9570,9406,9405,9409,9489,9472,9471,9581,25190,8825,8909,8877,8905,8953,8846,8894,8871,25768,8906,8972,12094,8919,8904,8862,8833,8821,8923]
url_base = 'http://www.mime.mineduc.cl/mime-web/mvc/mime/ficha?rbd='
#page = html.fromstring(urllib.urlopen(url).read())

#print page.find_class('mineduc')[0]
#print page.xpath('//table[@id="busqueda_avanzada"]//td/text()')

for rr in RBD:
    url = url_base+str(rr)
    page = html.fromstring(urllib.urlopen(url).read())
    ARRAY_BASE = []
    ARRAY = []
    COUNT = 0
    print str(rr)
    nombre_colegio = page.xpath('//table//td/text()')[2].encode('utf-8').strip()
    
    link = page.find_class('letra_capital')

    direccion = link[0].text.encode('utf-8').strip()

    # comuna = link[2].text.strip()
    telefono = link[3].text.encode('utf-8').strip()
    director = link[4].text.encode('utf-8').strip()
    #director = u' '.join((link[4].text)).encode('utf-8').strip()

    link_2 = page.xpath("//a")

    email = link_2[2].text.encode('utf-8').strip()
    web = link_2[3].text.encode('utf-8').strip()

    f = open('13region_colegios.csv', 'a')
    f.write(str(rr))
    f.write(',')
    f.write(nombre_colegio)
    f.write(',')
    f.write(direccion)
    f.write(',')
    f.write(telefono)
    f.write(',')
    f.write(director)
    f.write(',')
    f.write(email)
    f.write(',')
    f.write(web)
    f.write('\n')
    f.close()

    
        
    
    
